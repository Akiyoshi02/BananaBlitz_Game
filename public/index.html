<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Banana Blitz - Test your banana counting skills in this fun guessing game!" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="icon" href="assets/images/logo.png" type="image/png" />
    <title>Banana Blitz - Guess the Bananas!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css" />

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="backend/firebase-config.js"></script>

    <script src="javascript/auth.js"></script>
    <script src="javascript/multiplayer.js"></script>
    <script src="javascript/leaderboard.js"></script>
    <script src="javascript/friends.js"></script>
    <script src="javascript/game.js"></script>

</head>

<body
    class="min-h-screen flex flex-col bg-gradient-to-br from-yellow-100 to-yellow-300 font-poppins transition-colors duration-300 dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { poppins: ['Poppins', 'sans-serif'] },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'banana-spin': 'bananaSpin 2s linear infinite',
                    },
                    keyframes: {
                        wiggle: { '0%,100%': { transform: 'rotate(-3deg)' }, '50%': { transform: 'rotate(3deg)' } },
                        float: { '0%,100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        bananaSpin: { from: { transform: 'rotate(0deg)' }, to: { transform: 'rotate(360deg)' } }
                    }
                }
            }
        }
    </script>

    <div id="loader"
        class="fixed inset-0 bg-gradient-to-br from-yellow-400 to-orange-500 z-50 flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative">
            <img src="assets/images/logo.png" alt="Loading banana"
                class="w-32 h-32 md:w-48 md:h-48 lg:w-64 lg:h-64 animate-bounce-slow" />
            <div class="absolute -inset-4 bg-yellow-300 rounded-full blur-xl opacity-50 animate-pulse"></div>
        </div>
        <p id="loaderText" class="mt-4 md:mt-6 text-white text-lg md:text-xl font-bold mobile-text-center"
            aria-live="polite">Peeling bananas‚Ä¶ 0%</p>
        <div class="w-48 md:w-64 h-2 bg-yellow-200 rounded-full mt-2 md:mt-4 overflow-hidden">
            <div id="loaderBar" class="h-full bg-white rounded-full transition-all duration-300" style="width:0%"></div>
        </div>
    </div>

    <div id="app" class="flex-1 flex flex-col hidden">
        <div id="mobileMenuOverlay" class="mobile-hidden"></div>

        <div id="mobileMenu" class="mobile-hidden">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-yellow-600 dark:text-yellow-400">Quick Menu</h3>
                <button id="closeMobileMenu" class="p-2 rounded-full bg-gray-100 dark:bg-gray-700">
                    <span class="text-xl">‚úï</span>
                </button>
            </div>

            <div id="mobileUserCard" class="hidden mb-4 p-4 rounded-xl bg-yellow-100 dark:bg-gray-700">
                <div class="flex items-start gap-3">
                    <div class="flex-1">
                        <p id="mobileUserName" class="font-semibold text-yellow-900 dark:text-yellow-100">User</p>
                        <p id="mobileUserEmail" class="text-xs text-yellow-800/80 dark:text-yellow-200/70"></p>

                        <button onclick="logout()"
                            class="mt-2 text-xs bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-full transition-colors">
                            Logout
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-6 grid grid-cols-3 gap-2">
                <div class="text-center rounded-xl p-3 bg-yellow-50 dark:bg-gray-700">
                    <div class="text-xs opacity-70">Streak</div>
                    <div id="mobileStatStreak" class="font-bold">0</div>
                </div>
                <div class="text-center rounded-xl p-3 bg-yellow-50 dark:bg-gray-700">
                    <div class="text-xs opacity-70">Fastest</div>
                    <div id="mobileStatFastest" class="font-bold">‚Äî</div>
                </div>
                <div class="text-center rounded-xl p-3 bg-yellow-50 dark:bg-gray-700">
                    <div class="text-xs opacity-70">Points</div>
                    <div id="mobileStatPoints" class="font-bold">0</div>
                </div>
            </div>

            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-600 space-y-2">
                <button id="mobileThemeToggle" data-stay-open
                    class="w-full flex items-center gap-3 p-4 rounded-xl bg-gray-100 dark:bg-gray-600">
                    <span id="mobileThemeIcon" class="text-xl">üåû</span>
                    <span class="font-medium">Toggle Theme</span>
                </button>
                <button onclick="showHelp()"
                    class="w-full flex items-center gap-3 p-4 rounded-xl bg-gray-100 dark:bg-gray-600">
                    <span class="text-xl">‚ùì</span>
                    <span class="font-medium">Help</span>
                </button>
                <div class="text-center text-xs opacity-70 mt-2">
                    <button class="underline mr-2" onclick="openProfile()">Profile</button>
                    <button class="underline mr-2" onclick="loadLeaderboard()">Leaderboard</button>
                    <button class="underline" onclick="openSettings()">Settings</button>
                </div>
            </div>
        </div>

        <header
            class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-yellow-200 shadow-sm transition-colors duration-300 dark:bg-gray-900/80 dark:border-gray-700">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center header-container">
                <div class="flex items-center space-x-2">
                    <img src="assets/images/logo.png" alt="Banana Blitz Logo"
                        class="w-8 h-8 md:w-10 md:h-10 animate-wiggle" />
                    <h1 class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">Banana Blitz</h1>
                </div>
                <div class="flex items-center space-x-2 md:space-x-4">
                    <button id="mobileMenuBtn"
                        class="p-2 rounded-full bg-yellow-100 hover:bg-yellow-200 transition-colors dark:bg-gray-800 dark:hover:bg-gray-700 md:hidden"
                        aria-label="Open menu">
                        <span class="text-xl">‚ò∞</span>
                    </button>
                    <div id="desktopMenu" class="hidden md:flex items-center space-x-2 md:space-x-4">
                        <button id="themeToggle"
                            class="p-2 rounded-full bg-yellow-100 hover:bg-yellow-200 transition-colors dark:bg-gray-800 dark:hover:bg-gray-700"
                            aria-label="Toggle theme">
                            <span id="themeIcon" class="text-xl">üåû</span>
                        </button>
                        <button id="helpBtn"
                            class="px-3 py-1 rounded-md bg-gray-200 dark:bg-gray-700 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600 transition"
                            onclick="showHelp()" aria-label="Open help tutorial">‚ùì Help</button>
                        <div id="userInfo"
                            class="hidden flex items-center space-x-3 bg-yellow-100 px-4 py-2 rounded-full dark:bg-gray-800">
                            <span id="currentUser" class="font-medium text-yellow-800 dark:text-yellow-200"></span>
                            <button id="logoutBtn"
                                class="text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-full transition-colors"
                                onclick="logout()">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-4 py-6 md:py-8 flex-1 relative z-10">
            <div id="authSection" class="max-w-md mx-auto">
                <div
                    class="bg-white rounded-2xl shadow-xl p-6 md:p-8 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">
                    <div class="text-center mb-6 md:mb-8">
                        <div class="relative inline-block mb-4">
                            <img src="assets/images/logo.png" alt="Banana Blitz"
                                class="w-20 h-20 md:w-24 md:h-24 mx-auto animate-bounce-slow" />
                            <div class="absolute -inset-4 bg-yellow-300 rounded-full blur-xl opacity-30"></div>
                        </div>
                        <h2 id="authTitle"
                            class="text-2xl md:text-3xl font-bold text-yellow-600 dark:text-yellow-400 mb-2">Welcome
                            Back!</h2>
                        <p class="text-gray-600 dark:text-gray-300 mobile-text-sm">Solve math puzzles with bananas and
                            climb the
                            leaderboard!</p>
                    </div>

                    <div id="loginForm">
                        <div class="space-y-4">
                            <div>
                                <input type="text" id="loginUsername" placeholder="Username/Email"
                                    autocomplete="username"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                <div id="loginUsernameError" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <div>
                                <input type="password" id="loginPassword" placeholder="Password"
                                    autocomplete="current-password"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                <div id="loginPasswordError" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <button onclick="loginWithGoogle('login')"
                                class="w-full mb-4 bg-white border border-gray-300 hover:bg-gray-50 text-gray-800 font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center">
                                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt=""
                                    class="w-5 h-5 mr-2" />
                                Continue with Google
                            </button>
                            <button onclick="login()"
                                class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-lg">
                                Login
                            </button>
                        </div>
                        <p class="text-center mt-4 md:mt-6 text-gray-600 dark:text-gray-300">
                            Don't have an account?
                            <button
                                class="text-yellow-600 font-medium hover:text-yellow-700 dark:text-yellow-400 dark:hover:text-yellow-300 transition-colors"
                                onclick="showRegister()">Sign up</button>
                        </p>
                    </div>

                    <div id="registerForm" class="hidden">
                        <div class="space-y-4">
                            <div>
                                <input type="text" id="regUsername" placeholder="Username (e.g., BananaPro)"
                                    autocomplete="nickname"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                <div id="regUsernameError" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <div>
                                <input type="email" id="regEmail" placeholder="Email" autocomplete="email"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                <div id="regEmailError" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <div>
                                <input type="password" id="regPassword" placeholder="Password"
                                    autocomplete="new-password"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                <div id="regPasswordError" class="text-red-500 text-sm mt-1 hidden"></div>
                            </div>
                            <button onclick="loginWithGoogle('register')"
                                class="w-full mb-4 bg-white border border-gray-300 hover:bg-gray-50 text-gray-800 font-bold py-3 px-4 rounded-xl transition-colors flex items-center justify-center">
                                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt=""
                                    class="w-5 h-5 mr-2" />
                                Continue with Google
                            </button>
                            <button onclick="register()"
                                class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-3 px-4 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-lg">
                                Create Account
                            </button>
                        </div>
                        <p class="text-center mt-4 md:mt-6 text-gray-600 dark:text-gray-300">
                            Already have an account?
                            <button
                                class="text-yellow-600 font-medium hover:text-yellow-700 dark:text-yellow-400 dark:hover:text-yellow-300 transition-colors"
                                onclick="showLogin()">Sign in</button>
                        </p>
                    </div>
                </div>
            </div>

            <div id="menuSection" class="hidden max-w-6xl mx-auto">
                <div class="text-center mb-6 md:mb-8">
                    <p class="text-lg md:text-xl text-gray-700 dark:text-gray-300 max-w-2xl mx-auto mobile-px-2">Solve
                        math
                        puzzles with hidden bananas!
                        Test your skills in different game modes and compete with friends.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
                    <div class="lg:col-span-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 menu-grid">
                            <button onclick="goToGame()"
                                class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 hover:shadow-xl transition-all transform hover:-translate-y-1 md:hover:-translate-y-2 dark:bg-gray-800 dark:border-gray-700 group relative overflow-hidden game-card">
                                <div
                                    class="absolute top-0 right-0 w-12 h-12 md:w-16 md:h-16 bg-yellow-100 rounded-bl-full transition-colors group-hover:bg-yellow-200 dark:bg-gray-700">
                                </div>
                                <div
                                    class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform">
                                    üßÆ</div>
                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-1 md:mb-2">
                                    Classic Mode</h3>
                                <p class="text-sm md:text-base text-gray-600 dark:text-gray-300">Solve endless banana
                                    math puzzles</p>
                            </button>

                            <button onclick="goToMultiplayer()"
                                class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 hover:shadow-xl transition-all transform hover:-translate-y-1 md:hover:-translate-y-2 dark:bg-gray-800 dark:border-gray-700 group relative overflow-hidden game-card">
                                <div
                                    class="absolute top-0 right-0 w-12 h-12 md:w-16 md:h-16 bg-yellow-100 rounded-bl-full transition-colors group-hover:bg-yellow-200 dark:bg-gray-700">
                                </div>
                                <div
                                    class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform">
                                    üë•</div>
                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-1 md:mb-2">
                                    Multiplayer</h3>
                                <p class="text-sm md:text-base text-gray-600 dark:text-gray-300">Race against friends in
                                    real-time</p>
                            </button>

                            <button onclick="goToDaily()"
                                class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 hover:shadow-xl transition-all transform hover:-translate-y-1 md:hover:-translate-y-2 dark:bg-gray-800 dark:border-gray-700 group relative overflow-hidden game-card">
                                <div
                                    class="absolute top-0 right-0 w-12 h-12 md:w-16 md:h-16 bg-yellow-100 rounded-bl-full transition-colors group-hover:bg-yellow-200 dark:bg-gray-700">
                                </div>
                                <div
                                    class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform">
                                    üìÖ</div>
                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-1 md:mb-2">
                                    Daily Challenge</h3>
                                <p class="text-sm md:text-base text-gray-600 dark:text-gray-300">One special puzzle per
                                    day</p>
                            </button>

                            <button onclick="openProfile()"
                                class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 hover:shadow-xl transition-all transform hover:-translate-y-1 md:hover:-translate-y-2 dark:bg-gray-800 dark:border-gray-700 group relative overflow-hidden game-card">
                                <div
                                    class="absolute top-0 right-0 w-12 h-12 md:w-16 md:h-16 bg-yellow-100 rounded-bl-full transition-colors group-hover:bg-yellow-200 dark:bg-gray-700">
                                </div>
                                <div
                                    class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform">
                                    üë§</div>
                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-1 md:mb-2">
                                    Profile</h3>
                                <p class="text-sm md:text-base text-gray-600 dark:text-gray-300">View your stats &
                                    achievements</p>
                            </button>

                            <button onclick="loadLeaderboard()"
                                class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 hover:shadow-xl transition-all transform hover:-translate-y-1 md:hover:-translate-y-2 dark:bg-gray-800 dark:border-gray-700 group relative overflow-hidden game-card">
                                <div
                                    class="absolute top-0 right-0 w-12 h-12 md:w-16 md:h-16 bg-yellow-100 rounded-bl-full transition-colors group-hover:bg-yellow-200 dark:bg-gray-700">
                                </div>
                                <div
                                    class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform">
                                    üèÜ</div>
                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-1 md:mb-2">
                                    Leaderboard</h3>
                                <p class="text-sm md:text-base text-gray-600 dark:text-gray-300">See top players</p>
                            </button>

                            <button onclick="openSettings()"
                                class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 hover:shadow-xl transition-all transform hover:-translate-y-1 md:hover:-translate-y-2 dark:bg-gray-800 dark:border-gray-700 group relative overflow-hidden game-card">
                                <div
                                    class="absolute top-0 right-0 w-12 h-12 md:w-16 md:h-16 bg-yellow-100 rounded-bl-full transition-colors group-hover:bg-yellow-200 dark:bg-gray-700">
                                </div>
                                <div
                                    class="text-3xl md:text-4xl mb-3 md:mb-4 group-hover:scale-110 transition-transform">
                                    ‚öôÔ∏è</div>
                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-1 md:mb-2">
                                    Settings</h3>
                                <p class="text-sm md:text-base text-gray-700 dark:text-gray-300">Customize your
                                    experience</p>
                            </button>
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="bg-yellow-50 rounded-2xl p-4 md:p-6 h-full dark:bg-gray-800 sticky top-6">
                            <h3
                                class="text-lg md:text-xl font-bold text-yellow-600 dark:text-yellow-400 mb-3 md:mb-4 mobile-text-center">
                                How to Play</h3>
                            <div class="space-y-3 md:space-y-4">
                                <div class="flex items-start space-x-2 md:space-x-3">
                                    <div
                                        class="bg-yellow-500 text-white rounded-full w-6 h-6 md:w-8 md:h-8 flex items-center justify-center flex-shrink-0 font-bold text-sm md:text-base">
                                        1</div>
                                    <p class="text-sm md:text-base text-gray-700 dark:text-gray-300">Solve the math
                                        equation where a
                                        banana hides a number</p>
                                </div>
                                <div class="flex items-start space-x-2 md:space-x-3">
                                    <div
                                        class="bg-yellow-500 text-white rounded-full w-6 h-6 md:w-8 md:h-8 flex items-center justify-center flex-shrink-0 font-bold text-sm md:text-base">
                                        2</div>
                                    <p class="text-sm md:text-base text-gray-700 dark:text-gray-300">Guess how many
                                        bananas are hidden in
                                        the equation</p>
                                </div>
                                <div class="flex items-start space-x-2 md:space-x-3">
                                    <div
                                        class="bg-yellow-500 text-white rounded-full w-6 h-6 md:w-8 md:h-8 flex items-center justify-center flex-shrink-0 font-bold text-sm md:text-base">
                                        3</div>
                                    <p class="text-sm md:text-base text-gray-700 dark:text-gray-300">Earn points and
                                        climb the
                                        leaderboard!</p>
                                </div>
                            </div>

                            <div class="mt-4 md:mt-6 pt-4 md:pt-6 border-t border-yellow-200 dark:border-gray-600">
                                <h4
                                    class="text-base md:text-lg font-bold text-yellow-600 dark:text-yellow-400 mb-2 md:mb-3">
                                    Quick Tips
                                </h4>
                                <ul class="space-y-1 md:space-y-2 text-xs md:text-sm text-gray-600 dark:text-gray-300">
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">üéØ</span><span>Use hints
                                            wisely (-3
                                            points)</span>
                                    </li>
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">‚ö°</span><span>Faster
                                            answers = more
                                            points</span>
                                    </li>
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">üî•</span><span>Maintain
                                            streaks for
                                            combos</span>
                                    </li>
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">üèÜ</span><span>Play daily
                                            for bonus
                                            points</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="gameSection" class="hidden max-w-2xl mx-auto">
                <div
                    class="bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">
                    <div
                        class="flex justify-between items-center mb-4 md:mb-6 mobile-flex-col mobile-space-y-3 mobile-items-start">
                        <h2 class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">Solve the Banana
                            Math!</h2>
                        <div class="flex flex-wrap gap-1 md:gap-2 mobile-justify-center mobile-w-full">
                            <button id="hintBtn" onclick="getHint()"
                                class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white p-2 rounded-lg hover:from-yellow-600 hover:to-orange-600 transition-colors shadow-md text-sm md:text-base">üí°
                                Hint(-3)</button>
                            <button onclick="skipPuzzle()"
                                class="bg-yellow-100 text-yellow-800 hover:bg-yellow-200 p-2 rounded-lg transition-colors dark:bg-gray-700 dark:text-yellow-300 dark:hover:bg-gray-600 text-sm md:text-base">‚è≠
                                Skip</button>
                            <button id="pauseBtn" onclick="togglePause()"
                                class="bg-yellow-100 text-yellow-800 hover:bg-yellow-200 p-2 rounded-lg transition-colors dark:bg-gray-700 dark:text-yellow-300 dark:hover:bg-gray-600 text-sm md:text-base">‚è∏
                                Pause</button>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 mb-4 mobile-justify-center">
                        <div class="flex justify-center items-center w-full h-full gap-2">
                            <span id="livesHearts" class="font-semibold tracking-wide text-xl md:text-2xl">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                        </div>
                        <div class="flex-1 mobile-hidden"></div>
                    </div>

                    <div class="mb-4 md:mb-6 relative">
                        <div class="bg-yellow-50 rounded-xl p-3 md:p-4 mb-3 md:mb-4 dark:bg-gray-700">
                            <p class="text-center text-sm md:text-base text-gray-700 dark:text-gray-300">Find how many
                                bananas are
                                hidden in the equation!
                            </p>
                        </div>
                        <img id="puzzleImage" src="" alt="Puzzle"
                            class="w-full h-48 md:h-64 object-contain rounded-xl shadow-md bg-yellow-50 dark:bg-gray-700" />
                    </div>

                    <div class="mb-4 md:mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Time remaining</span>
                            <div class="flex items-center gap-3">
                                <span id="timeRemaining"
                                    class="text-xs md:text-sm font-bold text-yellow-600 dark:text-yellow-400"></span>
                                <span id="sessionTime"
                                    class="text-xs md:text-sm opacity-80 min-w-[44px] text-right hidden"></span>
                            </div>
                        </div>
                        <div id="timerWrapper"
                            class="w-full h-2 md:h-3 bg-gray-200 rounded-full overflow-hidden dark:bg-gray-700">
                            <div id="timerBar"
                                class="h-full bg-gradient-to-r from-green-500 to-yellow-500 rounded-full transition-all duration-1000"
                                style="width:100%"></div>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 md:gap-4 mb-4 md:mb-6 mobile-flex-col">
                        <input type="number" id="guessInput" placeholder="Enter your answer" min="0" inputmode="numeric"
                            class="flex-1 px-3 md:px-4 py-2 md:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                        <button onclick="try { submitGuess(); } catch(e) { console.error(e); }"
                            class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 md:py-3 px-4 md:px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-md mobile-w-full">
                            Submit
                        </button>
                    </div>

                    <div id="result" class="text-center text-base md:text-lg font-medium mb-4 md:mb-6"></div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-4 md:mb-6 game-stats">
                        <div class="bg-yellow-50 p-3 md:p-4 rounded-xl text-center dark:bg-gray-700">
                            <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300">üî• Streak</div>
                            <div id="streak" class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">
                                0</div>
                        </div>
                        <div class="bg-yellow-50 p-3 md:p-4 rounded-xl text-center dark:bg-gray-700">
                            <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300">‚úñ Combo</div>
                            <div id="combo" class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">
                                x1</div>
                        </div>
                        <div class="bg-yellow-50 p-3 md:p-4 rounded-xl text-center dark:bg-gray-700">
                            <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300">‚è± Fastest</div>
                            <div id="fastest"
                                class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">‚Äî</div>
                        </div>
                        <div class="bg-yellow-50 p-3 md:p-4 rounded-xl text-center dark:bg-gray-700">
                            <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300">üèÖ Points</div>
                            <div id="sessionPts"
                                class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">0</div>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 md:gap-4 mobile-flex-col">
                        <button onclick="returnToMenu()"
                            class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-colors dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white">
                            Back to Menu
                        </button>
                    </div>
                </div>
            </div>

            <div id="dailySection" class="hidden max-w-6xl mx-auto">
                <div class="flex flex-col lg:flex-row gap-4 md:gap-6 tablet-flex-col">
                    <div
                        class="flex-1 bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">

                        <div id="dailyPlayArea">
                            <div class="text-center mb-4 md:mb-6">
                                <h2 class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-2">üìÖ
                                    Daily Challenge
                                </h2>
                                <div class="bg-yellow-50 rounded-xl p-3 md:p-4 dark:bg-gray-700">
                                    <p id="dailyMeta"
                                        class="text-sm md:text-base text-gray-700 dark:text-gray-300 font-medium"></p>
                                    <div class="flex justify-center items-center mt-1 md:mt-2">
                                        <div
                                            class="bg-yellow-500 text-white px-2 md:px-3 py-1 rounded-full text-xs md:text-sm font-bold">
                                            <span id="dailyStreak">0</span> day streak!
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4 md:mb-6">
                                <div class="bg-blue-50 rounded-xl p-3 md:p-4 mb-3 md:mb-4 dark:bg-blue-900/20">
                                    <p
                                        class="text-center text-sm md:text-base text-blue-700 dark:text-blue-300 font-medium">
                                        Today's special puzzle - earn bonus points!
                                    </p>
                                </div>
                                <img id="dailyImage" alt="Daily Puzzle"
                                    class="w-full h-48 md:h-64 object-contain rounded-xl shadow-md bg-yellow-50 dark:bg-gray-700" />
                            </div>

                            <div class="flex flex-col md:flex-row gap-3 md:gap-4 mb-4 md:mb-6">
                                <input id="dailyGuess" type="number" placeholder="Your answer" min="0"
                                    inputmode="numeric"
                                    class="min-w-0 md:flex-1 px-3 md:px-4 py-2 md:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                <button id="dailySubmit" onclick="submitDaily()"
                                    class="w-full md:w-auto shrink-0 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 md:py-3 px-4 md:px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-md">
                                    Submit
                                </button>
                            </div>

                            <div id="dailyResult"
                                class="text-center text-base md:text-lg text-gray-600 dark:text-gray-300 font-medium mb-4 md:mb-6">
                            </div>
                        </div>

                        <div id="dailyCompleteCard" class="hidden mt-2">
                            <div class="rounded-2xl p-4 md:p-5 bg-yellow-50 dark:bg-gray-800 shadow-md">
                                <div class="flex items-start gap-2 md:gap-3">
                                    <div class="text-xl md:text-2xl shrink-0">‚úÖ</div>
                                    <div class="space-y-1">
                                        <p id="dailyCompleteTitle"
                                            class="font-bold text-yellow-800 dark:text-yellow-300 text-sm md:text-base">
                                            You've finished today's Daily!
                                        </p>
                                        <p id="dailyCompleteSubtitle"
                                            class="text-gray-700 dark:text-gray-300 text-xs md:text-sm">
                                            Great job. New challenge in <span id="dailyCountdown">--:--:--</span>.
                                        </p>
                                        <p id="dailyStreakLine" class="text-xs text-gray-600 dark:text-gray-400 hidden">
                                            Current streak: <span id="dailyStreakValue">0</span> üî•
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button onclick="returnToMenu()"
                            class="w-full mt-4 md:mt-6 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-colors dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white">
                            Back to Menu
                        </button>
                    </div>

                    <div
                        class="flex-1 bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">
                        <div class="bg-yellow-50 rounded-xl p-3 md:p-4 mb-4 md:mb-6 dark:bg-gray-700">
                            <h3
                                class="text-lg md:text-xl font-bold text-yellow-600 dark:text-yellow-400 mb-2 md:mb-3 mobile-text-center">
                                Today's Leaderboard
                            </h3>
                            <div class="flex justify-between items-center mb-3 md:mb-4 mobile-space-x-2">
                                <button id="dailyPrev" onclick="dailyPage(-1)"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 md:py-2 px-2 md:px-4 rounded-xl transition-colors dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white text-sm">Previous</button>
                                <span id="dailyPageInfo"
                                    class="text-xs md:text-sm text-gray-600 dark:text-gray-300 font-medium"></span>
                                <button id="dailyNext" onclick="dailyPage(1)"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 md:py-2 px-2 md:px-4 rounded-xl transition-colors dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white text-sm">Next</button>
                            </div>
                            <ul id="dailyLb" class="space-y-2 md:space-y-3"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="profileSection" class="hidden max-w-6xl mx-auto">
                <div class="flex flex-col lg:flex-row gap-4 md:gap-6 tablet-flex-col">
                    <div
                        class="flex-1 bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">
                        <div class="text-center mb-4 md:mb-6">
                            <h2 class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-2">üë§ Your
                                Profile</h2>
                            <div class="flex justify-center mb-3 md:mb-4">
                                <div class="relative">
                                    <div
                                        class="w-16 h-16 md:w-20 md:h-20 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center text-white text-xl md:text-2xl font-bold">
                                        <span id="profileInitials">U</span>
                                    </div>
                                    <div
                                        class="absolute -bottom-1 -right-1 bg-green-500 w-4 h-4 md:w-6 md:h-6 rounded-full border-2 border-white dark:border-gray-800">
                                    </div>
                                </div>
                            </div>
                            <p id="profileUsername" class="text-lg md:text-xl font-bold text-gray-800 dark:text-white">
                            </p>
                            <p id="profileEmail" class="text-sm md:text-base text-gray-600 dark:text-gray-300"></p>
                        </div>

                        <div class="mb-4 md:mb-6">
                            <button onclick="openChangeUsername()"
                                class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-md mb-3 md:mb-4">Change
                                Username</button>
                        </div>

                        <div class="mb-6 md:mb-8">
                            <h3
                                class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-3 md:mb-4 mobile-text-center">
                                Your Stats</h3>
                            <div id="profileStats"
                                class="grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-4 mobile-grid-cols-2"></div>
                        </div>

                        <button onclick="returnToMenu()"
                            class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-colors dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white">Back
                            to Menu</button>
                    </div>

                    <div
                        class="flex-1 bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">
                        <div>
                            <h3
                                class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-3 md:mb-4 mobile-text-center">
                                Achievements</h3>
                            <div class="bg-yellow-50 rounded-xl p-3 md:p-4 dark:bg-gray-700">
                                <ul id="achList" class="space-y-2 md:space-y-3"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="leaderboardSection" class="hidden max-w-2xl mx-auto">
                <div
                    class="bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">
                    <div class="text-center mb-4 md:mb-6">
                        <h2 id="lbHeaderTitle"
                            class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-2">üèÜ
                            Global
                            Leaderboard</h2>
                        <p id="lbHeaderSubtitle" class="text-sm md:text-base text-gray-600 dark:text-gray-300">Top
                            players from
                            around the world</p>
                    </div>

                    <div class="bg-yellow-50 rounded-xl p-3 md:p-4 mb-4 md:mb-6 dark:bg-gray-700">
                        <div
                            class="flex justify-between items-center mb-3 md:mb-4 mobile-flex-col mobile-space-y-3 mobile-items-stretch">
                            <div class="flex space-x-1 md:space-x-2 mobile-justify-center">
                                <button onclick="changeLeaderboardType('global')" id="lbGlobal"
                                    class="bg-yellow-500 text-white font-medium py-1 md:py-2 px-2 md:px-4 rounded-xl transition-colors text-sm md:text-base">Global</button>
                                <button onclick="changeLeaderboardType('friends')" id="lbFriends"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 md:py-2 px-2 md:px-4 rounded-xl transition-colors dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white text-sm md:text-base">Friends</button>
                            </div>

                            <div
                                class="text-xs md:text-sm text-gray-600 dark:text-gray-300 flex items-center mobile-justify-center">
                                <span id="lbTimeframe">Global ‚Äî All Time</span>
                                <button id="lbRefreshBtn" onclick="toggleTimeframe()"
                                    class="ml-1 md:ml-2 text-yellow-600 dark:text-yellow-400"
                                    aria-label="Refresh leaderboard" title="Refresh">
                                    <span id="lbRefreshIcon" class="inline-block">‚Üª</span>
                                </button>
                            </div>
                        </div>

                        <div id="friendsToolbar"
                            class="flex items-center justify-between mb-2 md:mb-3 hidden mobile-flex-col mobile-space-y-3 mobile-items-stretch">
                            <div class="flex items-center space-x-1 md:space-x-2 mobile-justify-center">
                                <button id="friendsAllTimeBtn"
                                    class="px-2 md:px-3 py-1 rounded-lg text-xs md:text-sm bg-yellow-500 text-white"
                                    onclick="changeFriendsScope('all')">All-time</button>
                                <button id="friendsTodayBtn"
                                    class="px-2 md:px-3 py-1 rounded-lg text-xs md:text-sm bg-gray-200 dark:bg-gray-600 dark:text-white"
                                    onclick="changeFriendsScope('today')">Today</button>
                            </div>
                            <div class="flex items-center space-x-2 md:space-x-3 mobile-justify-center mobile-mt-2">
                                <button onclick="openAddFriendModal()"
                                    class="text-yellow-700 dark:text-yellow-300 underline text-xs md:text-sm">Add
                                    Friend</button>
                                <div class="text-xs text-gray-600 dark:text-gray-300">
                                    Invites:
                                    <span id="invitesCount" class="font-semibold">0</span>
                                </div>
                            </div>
                        </div>

                        <div id="invitesPanel" class="mb-2 md:mb-3 hidden">
                            <div class="text-xs md:text-sm font-semibold text-gray-700 dark:text-gray-200 mb-1">Pending
                                Invites</div>
                            <div id="invitesBox" class="space-y-2"></div>
                        </div>

                        <ul id="leaderboardList" class="space-y-2 md:space-y-3"></ul>
                    </div>

                    <div class="bg-blue-50 rounded-xl p-3 md:p-4 mb-4 md:mb-6 dark:bg-blue-900/20">
                        <h3 class="text-base md:text-lg font-bold text-blue-600 dark:text-blue-400 mb-1 md:mb-2">Your
                            Ranking</h3>
                        <div id="userRank"
                            class="flex items-center justify-between p-2 md:p-3 bg-white rounded-lg dark:bg-gray-800 mobile-flex-col mobile-space-y-2 mobile-text-center">
                            <div class="flex items-center space-x-2 md:space-x-3 mobile-flex-col mobile-space-y-2">
                                <div id="userRankBadge"
                                    class="bg-yellow-500 text-white w-6 h-6 md:w-8 md:h-8 rounded-full flex items-center justify-center font-bold text-sm md:text-base">
                                    #
                                </div>
                                <div>
                                    <p class="font-bold text-gray-800 dark:text-white text-sm md:text-base">Your
                                        Position</p>
                                    <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Keep playing to
                                        climb!</p>
                                </div>
                            </div>
                            <div class="text-right mobile-text-center">
                                <p class="font-bold text-yellow-600 dark:text-yellow-400 text-sm md:text-base"
                                    id="userRankPosition">-
                                </p>
                                <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300" id="userRankScore">0 pts
                                </p>
                            </div>
                        </div>
                    </div>

                    <button onclick="returnToMenu()"
                        class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-md">
                        Back to Menu
                    </button>
                </div>

                <div id="addFriendModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50 p-4">
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-4 md:p-5 w-full max-w-sm">
                        <h3 class="text-base md:text-lg font-bold mb-2 md:mb-3 text-gray-800 dark:text-white">Add Friend
                            by Username
                        </h3>
                        <input id="addFriendInput"
                            class="w-full border rounded-lg p-2 mb-2 md:mb-3 dark:bg-gray-700 dark:border-gray-600"
                            placeholder="Enter username (exact)" />
                        <div class="flex justify-end space-x-1 md:space-x-2">
                            <button
                                class="px-2 md:px-3 py-1 md:py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-sm md:text-base"
                                onclick="closeAddFriendModal()">Cancel</button>
                            <button
                                class="px-2 md:px-3 py-1 md:py-2 rounded-lg bg-yellow-500 text-white text-sm md:text-base"
                                onclick="addFriendSubmit()">Add</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settingsSection" class="hidden max-w-7xl mx-auto">
                <div class="text-center mb-6 md:mb-8">
                    <h2
                        class="text-3xl md:text-4xl lg:text-5xl font-bold text-yellow-600 dark:text-yellow-400 mb-3 md:mb-4">
                        Settings ‚öôÔ∏è</h2>
                    <p class="text-lg md:text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto mobile-px-2">
                        Customize your
                        Banana Blitz experience
                    </p>
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-4 gap-4 md:gap-6 settings-grid">
                    <div class="xl:col-span-2">
                        <div
                            class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700 h-full">
                            <h3
                                class="text-lg md:text-xl font-bold text-yellow-600 dark:text-yellow-400 mb-3 md:mb-4 flex items-center">
                                <span class="mr-2">üéÆ</span> Game Preferences
                            </h3>
                            <div class="space-y-3 md:space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">Sound
                                            Effects</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Enable game
                                            sounds</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="soundToggle" checked class="sr-only peer">
                                        <div
                                            class="w-10 h-5 md:w-11 md:h-6 bg-gray-200 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-yellow-500">
                                        </div>
                                    </label>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">
                                            Background Music</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Play calm music
                                            during gameplay</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="musicToggle" class="sr-only peer">
                                        <div class="w-10 h-5 md:w-11 md:h-6 bg-gray-200 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full
             after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white
             after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all
             dark:border-gray-600 peer-checked:bg-yellow-500">
                                        </div>
                                    </label>
                                </div>

                                <div>
                                    <label for="musicVolume"
                                        class="block text-sm md:text-base font-medium text-gray-800 dark:text-white mb-1 md:mb-2">
                                        Music Volume
                                    </label>
                                    <input id="musicVolume" type="range" min="0" max="100" value="45" class="w-full">
                                    <div id="musicVolumeValue" class="text-xs text-gray-500 mt-1">45%</div>
                                </div>

                                <div>
                                    <label for="sfxVolume"
                                        class="block text-sm md:text-base font-medium text-gray-800 dark:text-white mb-1 md:mb-2">SFX
                                        Volume</label>
                                    <input id="sfxVolume" type="range" min="0" max="100" value="40" class="w-full">
                                    <div id="sfxVolumeValue" class="text-xs text-gray-500 mt-1">40%</div>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">Dark
                                            Mode</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Toggle dark/light
                                            theme</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="darkToggle" class="sr-only peer">
                                        <div
                                            class="w-10 h-5 md:w-11 md:h-6 bg-gray-200 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-yellow-500">
                                        </div>
                                    </label>
                                </div>

                                <div>
                                    <label for="difficultySelect"
                                        class="block font-medium text-gray-800 dark:text-white text-sm md:text-base mb-1 md:mb-2">Difficulty
                                        Level</label>
                                    <select id="difficultySelect"
                                        class="w-full px-3 md:px-4 py-2 md:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-600 dark:border-gray-500 dark:text-white text-sm md:text-base">
                                        <option value="easy">Easy (More time)</option>
                                        <option value="hard">Hard (Less time)</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="skinSelect"
                                        class="block font-medium text-gray-800 dark:text-white text-sm md:text-base mb-1 md:mb-2">Game
                                        Theme</label>
                                    <select id="skinSelect"
                                        class="w-full px-3 md:px-4 py-2 md:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-600 dark:border-gray-500 dark:text-white text-sm md:text-base">
                                        <option value="">Default Yellow</option>
                                        <option value="skin-jungle">Jungle Adventure</option>
                                        <option value="skin-neon">Neon Nights</option>
                                        <option value="skin-mono">Monochromatic</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="xl:col-span-1">
                        <div
                            class="bg-white rounded-2xl shadow-lg p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700 h-full">
                            <h3
                                class="text-lg md:text-xl font-bold text-blue-600 dark:text-blue-400 mb-3 md:mb-4 flex items-center">
                                <span class="mr-2">‚ôø</span> Accessibility
                            </h3>
                            <div class="space-y-3 md:space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">High
                                            Contrast</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Increase color
                                            contrast</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="hcToggle" class="sr-only peer">
                                        <div
                                            class="w-10 h-5 md:w-11 md:h-6 bg-gray-200 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-500">
                                        </div>
                                    </label>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">Large
                                            Text</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Increase text
                                            size</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="largeToggle" class="sr-only peer">
                                        <div
                                            class="w-10 h-5 md:w-11 md:h-6 bg-gray-200 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-500">
                                        </div>
                                    </label>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">
                                            Reduced Motion</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Minimize
                                            animations</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="rmToggle" class="sr-only peer">
                                        <div
                                            class="w-10 h-5 md:w-11 md:h-6 bg-gray-200 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-500">
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="xl:col-span-1">
                        <div class="bg-yellow-50 rounded-2xl p-4 md:p-6 h-full dark:bg-gray-800 sticky top-6">
                            <h3
                                class="text-lg md:text-xl font-bold text-yellow-600 dark:text-yellow-400 mb-3 md:mb-4 mobile-text-center">
                                Settings Guide</h3>

                            <div class="space-y-3 md:space-y-4 mb-4 md:mb-6">
                                <div class="flex items-start space-x-2 md:space-x-3">
                                    <div
                                        class="bg-yellow-500 text-white rounded-full w-5 h-5 md:w-6 md:h-6 flex items-center justify-center flex-shrink-0 text-xs font-bold">
                                        üéÆ</div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">Game
                                            Preferences</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Adjust sound,
                                            theme, and difficulty
                                        </p>
                                    </div>
                                </div>

                                <div class="flex items-start space-x-2 md:space-x-3">
                                    <div
                                        class="bg-blue-500 text-white rounded-full w-5 h-5 md:w-6 md:h-6 flex items-center justify-center flex-shrink-0 text-xs font-bold">
                                        ‚ôø</div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">
                                            Accessibility</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Make the game
                                            more comfortable</p>
                                    </div>
                                </div>

                                <div class="flex items-start space-x-2 md:space-x-3">
                                    <div
                                        class="bg-red-500 text-white rounded-full w-5 h-5 md:w-6 md:h-6 flex items-center justify-center flex-shrink-0 text-xs font-bold">
                                        ‚ö†</div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white text-sm md:text-base">Danger
                                            Zone</p>
                                        <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Reset progress or
                                            export data</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4 md:mt-6 pt-4 md:pt-6 border-t border-yellow-200 dark:border-gray-600">
                                <h4
                                    class="text-base md:text-lg font-bold text-yellow-600 dark:text-yellow-400 mb-2 md:mb-3">
                                    Quick Tips
                                </h4>
                                <ul class="space-y-1 md:space-y-2 text-xs md:text-sm text-gray-600 dark:text-gray-300">
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">üîä</span><span>Adjust
                                            volume for the best
                                            experience</span></li>
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">üåô</span><span>Dark mode
                                            reduces eye
                                            strain</span>
                                    </li>
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">‚ö°</span><span>Hard mode =
                                            more points!</span>
                                    </li>
                                    <li class="flex items-center"><span class="mr-1 md:mr-2">üíæ</span><span>Export data
                                            to backup
                                            progress</span>
                                    </li>
                                </ul>
                            </div>

                            <div class="text-center mt-6 md:mt-8">
                                <button onclick="returnToMenu()"
                                    class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 md:py-3 px-4 md:px-8 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-md">
                                    Back to Menu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="multiplayerLobbySection" class="hidden max-w-2xl mx-auto">
                <div
                    class="bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">
                    <div class="text-center mb-4 md:mb-6">
                        <h2 class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-2">üë•
                            Multiplayer Mode</h2>
                        <p class="text-sm md:text-base text-gray-600 dark:text-gray-300">Challenge friends in real-time
                            banana math
                            battles!</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4 md:mb-6">
                        <button onclick="createRoom()"
                            class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 md:py-4 px-4 md:px-6 rounded-xl transition-all transform hover:-translate-y-1 shadow-lg">
                            <div class="text-2xl mb-1 md:mb-2">üè†</div>
                            <h3 class="text-base md:text-lg font-bold mb-1">Create Room</h3>
                            <p class="text-xs md:text-sm opacity-90">Start a new game room</p>
                        </button>

                        <div class="bg-yellow-50 p-3 md:p-4 rounded-xl dark:bg-gray-700">
                            <h3 class="font-bold text-yellow-600 dark:text-yellow-400 mb-1 md:mb-2">Join Room</h3>
                            <div class="flex space-x-1 md:space-x-2 mobile-flex-col mobile-space-y-2">
                                <input type="text" id="roomCodeInput" placeholder="Enter room code"
                                    class="flex-1 px-2 md:px-3 py-1 md:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-600 dark:border-gray-500 dark:text-white text-sm md:text-base" />
                                <button onclick="joinRoom()"
                                    class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-1 md:py-2 px-2 md:px-4 rounded-lg transition-all transform hover:scale-105 active:scale-95 text-xs md:text-sm mobile-w-full">Join</button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-3 md:p-4 rounded-xl dark:bg-blue-900/20 mb-4 md:mb-6">
                        <h3 class="font-bold text-blue-600 dark:text-blue-400 mb-1 md:mb-2">How to Play Multiplayer</h3>
                        <ul class="text-xs md:text-sm text-blue-700 dark:text-blue-300 space-y-1">
                            <li class="flex items-start"><span class="mr-1 md:mr-2">‚Ä¢</span><span>Create a room and
                                    share the code
                                    with
                                    friends</span></li>
                            <li class="flex items-start"><span class="mr-1 md:mr-2">‚Ä¢</span><span>Everyone gets the same
                                    banana math
                                    puzzle</span></li>
                            <li class="flex items-start"><span class="mr-1 md:mr-2">‚Ä¢</span><span>Fastest correct
                                    answers get more
                                    points</span></li>
                            <li class="flex items-start"><span class="mr-1 md:mr-2">‚Ä¢</span><span>Play 3 rounds to
                                    determine the
                                    winner!</span></li>
                        </ul>
                    </div>

                    <button onclick="returnToMenu()"
                        class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-colors dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white">Back
                        to Menu</button>
                </div>
            </div>

            <div id="multiplayerSection" class="hidden max-w-2xl mx-auto">
                <div
                    class="bg-white rounded-2xl shadow-xl p-4 md:p-6 border border-yellow-200 dark:bg-gray-800 dark:border-gray-700">

                    <div
                        class="flex justify-between items-center mb-4 md:mb-6 mobile-flex-col mobile-space-y-3 mobile-items-stretch">
                        <div class="mobile-text-center">
                            <h2 class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">Multiplayer
                                Game</h2>
                            <p class="text-sm md:text-base text-gray-600 dark:text-gray-300">Room:
                                <span id="multiplayerRoomCode"
                                    class="font-mono font-bold bg-yellow-100 px-1 md:px-2 py-1 rounded dark:bg-gray-700">‚Äî</span>
                            </p>
                        </div>
                        <button onclick="leaveRoom()"
                            class="bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold py-1 md:py-2 px-2 md:px-4 rounded-lg transition-all transform hover:scale-105 active:scale-95 text-sm md:text-base mobile-w-full">
                            Leave Room
                        </button>
                    </div>

                    <div id="multiplayerStatus"
                        class="text-center text-base md:text-lg font-medium mb-4 md:mb-6 p-3 md:p-4 bg-yellow-50 rounded-xl dark:bg-gray-700">
                        Loading...</div>

                    <div id="multiplayerLobby">
                        <h3
                            class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-3 md:mb-4 mobile-text-center">
                            Players in Room</h3>
                        <ul id="multiplayerPlayers" class="space-y-2 md:space-y-3 mb-4 md:mb-6"></ul>

                        <div class="flex flex-col md:flex-row gap-3 md:gap-4 mt-2">
                            <button id="multiplayerStartBtn"
                                class="hidden w-full md:w-auto shrink-0 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 md:py-3 px-3 md:px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95">
                                üöÄ Start Game
                            </button>

                            <button id="multiplayerReadyBtn"
                                class="hidden w-full md:w-auto shrink-0 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 md:py-3 px-3 md:px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95">
                                ‚úÖ Ready Up
                            </button>
                        </div>
                    </div>

                    <div id="multiplayerGame" class="hidden">
                        <div class="text-center mb-3 md:mb-4">
                            <div class="text-base md:text-lg font-bold text-yellow-600 dark:text-yellow-400"
                                id="multiplayerRoundInfo">Round 1 of 3
                            </div>
                        </div>

                        <div class="mb-4 md:mb-6">
                            <div class="flex justify-between items-center mb-1 md:mb-2">
                                <span class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Time remaining</span>
                                <span id="mpTimeRemaining"
                                    class="text-xs md:text-sm font-bold text-yellow-600 dark:text-yellow-400">60s</span>
                            </div>
                            <div id="mpTimerWrapper"
                                class="w-full h-2 md:h-3 bg-gray-200 rounded-full overflow-hidden dark:bg-gray-700">
                                <div id="mpTimerBar"
                                    class="h-full bg-gradient-to-r from-green-500 to-yellow-500 rounded-full transition-all duration-1000"
                                    style="width:100%"></div>
                            </div>
                        </div>

                        <div class="mb-4 md:mb-6 relative">
                            <div class="bg-yellow-50 rounded-xl p-3 md:p-4 mb-3 md:mb-4 dark:bg-gray-700">
                                <p class="text-center text-sm md:text-base text-gray-700 dark:text-gray-300">Race to
                                    solve the banana
                                    math puzzle first!</p>
                            </div>
                            <img id="multiplayerImage" src="" alt="Multiplayer Puzzle"
                                class="w-full h-48 md:h-64 object-contain rounded-xl shadow-md bg-yellow-50 dark:bg-gray-700" />
                        </div>

                        <div class="grid grid-cols-2 gap-2 md:gap-4 mb-4 md:mb-6 mobile-grid-cols-2">
                            <div class="bg-yellow-50 p-3 md:p-4 rounded-xl text-center dark:bg-gray-700">
                                <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Your Score</div>
                                <div id="multiplayerPlayerScore"
                                    class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">0
                                </div>
                            </div>
                            <div class="bg-yellow-50 p-3 md:p-4 rounded-xl text-center dark:bg-gray-700">
                                <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300">Status</div>
                                <div id="multiplayerPlayerStatus"
                                    class="text-base md:text-lg font-bold text-yellow-600 dark:text-yellow-400">‚Äî
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row gap-3 md:gap-4 mb-4 md:mb-6">
                            <input id="multiplayerGuess" type="number" placeholder="Enter your answer" min="0"
                                inputmode="numeric"
                                class="min-w-0 md:flex-1 px-3 md:px-4 py-2 md:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                            <button onclick="submitMultiplayerGuess()"
                                class="w-full md:w-auto shrink-0 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 md:py-3 px-3 md:px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95">
                                Submit
                            </button>
                        </div>

                        <div class="mb-4 md:mb-6">
                            <h4
                                class="font-bold text-gray-800 dark:text-white text-base md:text-lg mb-2 md:mb-3 mobile-text-center">
                                Live Scores</h4>
                            <ul id="multiplayerLiveScores" class="space-y-1 md:space-y-2"></ul>
                        </div>
                    </div>

                    <div id="multiplayerResults" class="hidden">
                        <h3
                            class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-3 md:mb-4 mobile-text-center">
                            Game Results! üèÜ</h3>
                        <ul id="multiplayerResultsList" class="space-y-2 md:space-y-3 mb-4 md:mb-6"></ul>
                        <div class="flex space-x-2 md:space-x-4 mobile-flex-col mobile-space-y-3">
                            <div class="flex flex-col md:flex-row gap-3 md:gap-4 mt-1">
                                <button onclick="playAgainSameRoom()"
                                    class="w-full md:flex-1 shrink-0 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-all transform hover:scale-105 active:scale-95">
                                    Play Again
                                </button>

                                <button onclick="returnToMenu()"
                                    class="w-full md:flex-1 shrink-0 bg-gray-200 hover:bg-gray-300 text-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-bold py-2 md:py-3 px-3 md:px-4 rounded-xl transition-colors">
                                    Main Menu
                                </button>
                            </div>

                        </div>

                        <div class="mt-4 md:mt-6">
                            <h3
                                class="text-lg md:text-xl font-bold text-gray-800 dark:text-white mb-2 md:mb-3 mobile-text-center">
                                Room Chat
                            </h3>

                            <div
                                class="rounded-xl border border-yellow-200 dark:border-gray-700 bg-yellow-50 dark:bg-gray-700 p-3 md:p-4">
                                <div id="mpChatList"
                                    class="h-48 md:h-56 overflow-y-auto rounded-lg bg-white dark:bg-gray-800 p-2 md:p-3 space-y-2">
                                </div>

                                <div class="mt-2 md:mt-3 flex gap-2 md:gap-3">
                                    <input id="mpChatInput" type="text" maxlength="300" placeholder="Type a message‚Ä¶"
                                        class="flex-1 px-3 md:px-4 py-2 md:py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm md:text-base" />
                                    <button id="mpChatSendBtn"
                                        class="shrink-0 px-3 md:px-4 py-2 rounded-lg text-sm md:text-base font-semibold text-white bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 transition">
                                        Send
                                    </button>
                                </div>

                                <p class="mt-1 text-[11px] md:text-xs text-gray-600 dark:text-gray-300">
                                    Press <kbd class="px-1 py-0.5 bg-gray-200 dark:text-black rounded">Enter</kbd> to
                                    send. Max 300 chars.
                                </p>
                            </div>
                        </div>

                    </div>
                </div>

        </main>

        <div id="celebration" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden p-4">
            <div class="bg-white rounded-2xl p-4 md:p-6 lg:p-8 max-w-md w-full text-center dark:bg-gray-800">
                <h3 class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400 mb-3 md:mb-4">
                    Congratulations! üéâ
                </h3>
                <img id="celebrationGif" alt="Celebration"
                    class="w-full h-40 md:h-48 object-cover rounded-xl mb-3 md:mb-4" />
                <p class="text-sm md:text-base text-gray-700 dark:text-gray-300 mb-4 md:mb-6">You solved the banana math
                    puzzle!
                    Keep up the great work!</p>
                <button onclick="hideCelebration()"
                    class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 px-4 md:px-6 rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-md text-sm md:text-base">Continue</button>
            </div>
        </div>

        <div id="toast"
            class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl shadow-lg z-50 transition-all duration-300 opacity-0 pointer-events-none max-w-xs md:max-w-md w-full text-center">
            <div class="flex items-center space-x-1 md:space-x-2 justify-center">
                <span id="toastIcon">‚Ñπ</span>
                <span id="toastMessage" class="text-sm md:text-base">This is a toast message</span>
            </div>
        </div>
    </div>

    <div id="changeUsernameOverlay" class="fixed inset-0 z-50 hidden bg-black/60 backdrop-blur-sm" role="dialog"
        aria-modal="true" aria-labelledby="cu-title">
        <div class="min-h-full w-full flex items-center justify-center p-4">
            <div class="w-full max-w-md rounded-2xl bg-white shadow-xl p-4 md:p-6 dark:bg-gray-800" role="document">
                <div class="flex items-start justify-between mb-3 md:mb-4">
                    <h3 id="cu-title" class="text-lg md:text-xl font-bold text-yellow-600 dark:text-yellow-400">Change
                        Username
                    </h3>
                    <button onclick="closeChangeUsername()"
                        class="p-1 md:p-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600"
                        aria-label="Close">‚úï</button>
                </div>

                <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300 mb-3 md:mb-4">Usernames are 3‚Äì20
                    characters.
                    Allowed: letters,
                    numbers, <code>_ . -</code> and spaces.</p>

                <label for="cu-input"
                    class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New
                    username</label>
                <input id="cu-input" type="text" autocomplete="nickname"
                    class="w-full mb-1 px-3 md:px-4 py-2 md:py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm md:text-base" />

                <div class="min-h-[1.5rem] mb-1 md:mb-2 text-xs md:text-sm" aria-live="polite" aria-atomic="true">
                    <span id="cu-status" class="hidden"></span>
                </div>

                <div id="cu-error" class="text-red-500 text-xs md:text-sm mb-2 md:mb-3 hidden"></div>

                <div class="flex gap-2 md:gap-3 justify-end">
                    <button onclick="closeChangeUsername()"
                        class="btn-secondary text-gray-800 dark:text-white text-sm md:text-base py-2 px-3 md:px-4">Cancel</button>
                    <button id="cu-save" onclick="submitChangeUsername()"
                        class="btn-primary text-gray-800 dark:text-white text-sm md:text-base py-2 px-3 md:px-4"
                        disabled>Save</button>
                </div>
            </div>
        </div>
    </div>

    <div id="tutorialOverlay" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60"></div>
        <div
            class="relative max-w-xs md:max-w-md lg:max-w-xl mx-auto mt-16 md:mt-24 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 rounded-2xl p-4 md:p-6 shadow-2xl m-4">
            <h2 class="text-lg md:text-xl font-bold mb-2">Welcome to BananaBlitz! üçå</h2>
            <ol class="list-decimal list-inside space-y-1 md:space-y-2 text-xs md:text-sm">
                <li>Guess how many bananas are in the puzzle image.</li>
                <li>Press <kbd class="px-1 py-0.5 bg-gray-200 dark:text-black rounded text-xs">?</kbd> for a help.</li>
                <li>Use <kbd class="px-1 py-0.5 bg-gray-200 dark:text-black rounded text-xs">H</kbd> for a hint,<kbd
                        class="px-1 py-0.5 bg-gray-200 dark:text-black rounded text-xs">R</kbd> for next puzzle.</li>
                <li>Toggle sound with <kbd class="px-1 py-0.5 bg-gray-200 dark:text-black rounded text-xs">M</kbd>,
                    theme at top
                    right.
                </li>
                <li>Play daily challenge or go multiplayer with friends!</li>
            </ol>
            <div class="flex items-center justify-between mt-3 md:mt-4 text-xs text-gray-500">
                <span id="tutorialCountdown">Auto closes in 30s‚Ä¶</span>
                <div class="space-x-1 md:space-x-2">
                    <button id="tutorialGotIt"
                        class="px-2 md:px-3 py-1 rounded-md bg-yellow-500 text-white text-xs md:text-sm">Got it</button>
                </div>
            </div>
        </div>
    </div>

    <div id="gameOverModal" class="hidden fixed inset-0 z-50 bg-black/60 items-center justify-center p-4">
        <div class="w-full max-w-md rounded-2xl bg-white dark:bg-gray-800 shadow-xl p-4 md:p-6 space-y-3 md:space-y-4">
            <h2 id="gameOverTitle"
                class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white flex justify-center items-center w-full">
                Game
                Over</h2>
            <p id="gameOverText" class="text-sm md:text-base text-gray-700 dark:text-gray-200 text-center">
                Final Score: 0 pts ‚Ä¢ Correct: 0/0
            </p>

            <div class="flex gap-1 md:gap-2 mobile-flex-col mobile-space-y-2">
                <button id="goPlayAgain"
                    class="flex-1 px-3 md:px-4 py-2 rounded-xl bg-yellow-500 text-black font-semibold hover:bg-yellow-400 transition text-sm md:text-base">
                    Play Again
                </button>
                <button id="shareBtn"
                    class="px-3 md:px-4 py-2 rounded-xl bg-green-500 text-white font-semibold hover:bg-green-600 transition text-sm md:text-base">
                    Share
                </button>
            </div>

            <div class="flex gap-1 md:gap-2">
                <button id="goHome"
                    class="flex-1 px-3 md:px-4 py-2 rounded-xl bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition text-sm md:text-base">
                    Back to Menu
                </button>
            </div>
        </div>
    </div>

    <footer
        class="mt-auto bg-white/80 backdrop-blur-md border-t border-yellow-200 shadow-sm transition-colors duration-300 dark:bg-gray-900/80 dark:border-gray-700">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-2 mb-4 md:mb-0">
                    <img src="assets/images/logo.png" alt="Banana Blitz Logo"
                        class="w-8 h-8 md:w-10 md:h-10 animate-wiggle" />
                    <span class="text-xl md:text-2xl font-bold text-yellow-600 dark:text-yellow-400">Banana Blitz</span>
                </div>

                <div class="flex space-x-4">
                    <a href="https://x.com/akiyapax"
                        class="text-gray-600 hover:text-yellow-600 dark:text-gray-300 dark:hover:text-yellow-400 transition-colors"
                        aria-label="X (formerly Twitter)">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                            <path
                                d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" />
                        </svg>
                    </a>
                    <a href="https://www.facebook.com/Akiyoshi.Yapa"
                        class="text-gray-600 hover:text-yellow-600 dark:text-gray-300 dark:hover:text-yellow-400 transition-colors"
                        aria-label="Facebook">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z">
                            </path>
                        </svg>
                    </a>
                    <a href="https://www.instagram.com/_.akiya_/"
                        class="text-gray-600 hover:text-yellow-600 dark:text-gray-300 dark:hover:text-yellow-400 transition-colors"
                        aria-label="Instagram">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z">
                            </path>
                        </svg>
                    </a>
                </div>
            </div>

            <div class="mt-4 pt-4 border-t border-yellow-200 dark:border-gray-700 text-center">
                <p class="text-xs text-gray-500 dark:text-gray-400">
                    &copy; 2025 Banana Blitz. All rights reserved. Made with üçå by Akiyoshi Yapa.
                </p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menu = document.getElementById('mobileMenu');
            const overlay = document.getElementById('mobileMenuOverlay');
            const openBtn = document.getElementById('mobileMenuBtn');
            const closeBtn = document.getElementById('closeMobileMenu');

            const userCard = document.getElementById('mobileUserCard');
            const nameEl = document.getElementById('mobileUserName');
            const emailEl = document.getElementById('mobileUserEmail');
            const avatarEl = document.getElementById('mobileUserAvatar');
            const streakEl = document.getElementById('mobileStatStreak');
            const fastestEl = document.getElementById('mobileStatFastest');
            const pointsEl = document.getElementById('mobileStatPoints');

            const desktopThemeBtn = document.getElementById('themeToggle');
            const desktopThemeIcon = document.getElementById('themeIcon');
            const mobileThemeBtn = document.getElementById('mobileThemeToggle');
            const mobileThemeIcon = document.getElementById('mobileThemeIcon');

            const initialsFrom = (s) => {
                const str = (s || '').trim();
                if (!str) return 'U';
                if (str.includes('@')) return str[0].toUpperCase();
                const parts = str.split(/\s+/);
                return (parts[0][0] + (parts[1]?.[0] || '')).toUpperCase();
            };

            const setThemeIcons = () => {
                const isDark = document.documentElement.classList.contains('dark');
                if (desktopThemeIcon) desktopThemeIcon.textContent = isDark ? 'üåô' : 'üåû';
                if (mobileThemeIcon) mobileThemeIcon.textContent = isDark ? 'üåô' : 'üåû';
            };

            const setTheme = (isDark) => {
                document.documentElement.classList.toggle('dark', !!isDark);
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                setThemeIcons();

                const chk = document.getElementById('darkToggle');
                if (chk && chk.checked !== isDark) chk.checked = isDark;

                window.dispatchEvent(new CustomEvent('themechange', { detail: { isDark } }));
            };

            const toggleTheme = () => setTheme(!document.documentElement.classList.contains('dark'));

            const initTheme = () => {
                const saved = localStorage.getItem('theme');
                setTheme(saved === 'dark');
            };

            const refreshDrawer = async () => {
                const g = window.game || {};
                const user = g?.auth?.currentUser || null;

                if (userCard) {
                    if (user) {
                        userCard.classList.remove('hidden');
                        const display = g.usernameGlobal || user.displayName || user.email || 'User';
                        if (nameEl) nameEl.textContent = display;
                        if (emailEl) emailEl.textContent = user.email || '';
                        if (avatarEl) avatarEl.textContent = initialsFrom(display);
                    } else {
                        userCard.classList.add('hidden');
                    }
                }

                if (streakEl) streakEl.textContent = g?.streak ?? 0;
                if (fastestEl) fastestEl.textContent = g?.fastestSolve || '‚Äî';
                if (pointsEl) pointsEl.textContent = g?.sessionPoints ?? 0;
            };

            const openDrawer = () => { menu?.classList.add('open'); overlay?.classList.add('open'); refreshDrawer(); };
            const closeDrawer = () => { menu?.classList.remove('open'); overlay?.classList.remove('open'); };

            menu?.addEventListener('click', (e) => {
                const actionable = e.target.closest('button, a, [data-close-on-click="true"]');
                if (!actionable) return;

                if (actionable.closest('[data-stay-open]')) return;

                const isFormControl = e.target.matches('input, select, textarea') ||
                    e.target.closest('label');
                if (isFormControl) return;

                setTimeout(() => closeDrawer(), 0);
            });

            openBtn?.addEventListener('click', openDrawer);
            closeBtn?.addEventListener('click', closeDrawer);
            overlay?.addEventListener('click', closeDrawer);
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && menu?.classList.contains('open')) closeDrawer();
            });

            desktopThemeBtn?.addEventListener('click', toggleTheme);
            mobileThemeBtn?.addEventListener('click', toggleTheme);

            document.getElementById('darkToggle')?.addEventListener('change', (e) => {
                setTheme(e.target.checked);
            });

            let _drawerPulse = setInterval(() => {
                if (document.getElementById('mobileMenu')?.classList.contains('open')) {
                    const g = window.game || {};
                    const streakEl = document.getElementById('mobileStatStreak');
                    const fastestEl = document.getElementById('mobileStatFastest');
                    const pointsEl = document.getElementById('mobileStatPoints');
                    if (streakEl) streakEl.textContent = g?.streak ?? 0;
                    if (fastestEl) fastestEl.textContent = g?.fastestSolve || '‚Äî';
                    if (pointsEl) pointsEl.textContent = g?.sessionPoints ?? 0;
                }
            }, 2000);

            initTheme();
        });
    </script>

</body>

</html>